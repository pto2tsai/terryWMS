# WMS 倉儲管理系統 V50.9 功能說明書

## 📋 目錄

1. [系統概述](#系統概述)
2. [登入與權限](#登入與權限)
3. [數位倉庫](#數位倉庫)
4. [戰情分析](#戰情分析)
5. [入庫管理](#入庫管理)
6. [出庫管理](#出庫管理)
7. [庫存異動作業](#庫存異動作業)
8. [倉租寄倉](#倉租寄倉)
9. [進階報表](#進階報表)
10. [系統管理](#系統管理)
11. [資料同步與備份](#資料同步與備份)
12. [公司別管理](#公司別管理)

---

## 系統概述

### 系統簡介
WMS（Warehouse Management System）是一套專為中小型倉儲設計的全功能管理系統，支援多公司別（崇文/八方）、多倉庫管理，具備完整的入庫、出庫、調撥、盤點、寄倉等功能。

### 技術架構
- **前端**：HTML5 + TailwindCSS + JavaScript
- **後端資料庫**：Firebase Firestore（雲端即時同步）
- **認證系統**：Firebase Authentication
- **部署方式**：單一 HTML 檔案，可本地運行或部署至任何網頁伺服器

### 倉庫區域配置
| 區域代碼 | 名稱 | 用途 | 巷道數 |
|---------|------|------|--------|
| I-A | I棟A區 | 成品儲存 | 8 巷 |
| I-B | I棟B區 | 成品儲存 | 8 巷 |
| J-C | J棟C區 | 原料儲存 | 8 巷 |
| J-D | J棟D區 | 原料儲存 | 8 巷 |
| K-E ~ K-H | K棟E-H區 | 混合儲存 | 各8巷 |
| O | 虛擬區 | 暫存/退貨/待驗 | 多個虛擬儲位 |

### 儲位編碼規則
```
格式：區域-巷道-層級
範例：I-A-05-2F
      │ │  │  └─ 層級（1F/2F/3F）
      │ │  └──── 巷道編號（01-08）
      │ └─────── 子區域（A/B/C...）
      └───────── 主區域（I/J/K）
```

---

## 登入與權限

### 登入方式
1. 開啟系統後顯示登入畫面
2. 輸入 Email 和密碼
3. 點擊「登入」按鈕

### 角色權限

| 角色 | 權限等級 | 可用功能 |
|------|---------|---------|
| 管理員 (admin) | 100 | 全部功能 |
| 倉管主管 (supervisor) | 90 | 除權限管理外全部 |
| 財務人員 (finance) | 85 | 報表、倉租、寄倉、庫存查詢 |
| 倉管人員 (warehouse) | 80 | 入庫、出庫、調度、盤點 |
| 業務人員 (sales) | 70 | 庫存查詢、報表、寄倉 |
| 現場人員 (operator) | 60 | 入庫、出庫、移位 |
| 訪客 (guest) | 10 | 僅查看 |

### 權限控制項目
- `inbound` - 入庫作業
- `outbound` - 出庫作業
- `move` - 移位作業
- `merge` - 合併作業
- `stocktake` - 盤點作業
- `approve` - 審核權限
- `dispatch` - 派車管理
- `consignment` - 寄倉管理
- `rental` - 倉租報表
- `report` - 進階報表
- `analysis` - 數據分析
- `users` - 使用者管理
- `settings` - 系統設定

---

## 數位倉庫

### 倉庫地圖

#### 功能說明
以視覺化方式呈現整個倉庫的儲位使用狀況，支援即時更新。

#### 操作方式
1. 進入「數位倉庫 > 倉庫地圖」
2. 畫面顯示各區域的格狀地圖
3. 每個格子代表一個巷道
4. 顏色表示：
   - 🟢 綠色：有庫存
   - ⬜ 空白：無庫存
   - 🟡 黃色：效期警示
   - 🔴 紅色：已過期

#### 互動功能
- **點擊巷道**：展開顯示該巷道所有儲位的詳細資料
- **顯示資訊**：品名、規格、數量、效期、入庫日期

### 庫存查詢

#### 功能說明
查詢系統中所有庫存，支援多維度篩選和匯出。

#### 操作方式
1. 進入「數位倉庫 > 庫存查詢」
2. 頂部提供篩選選項：
   - **公司**：全部 / 崇文 / 八方
   - **搜尋框**：輸入品名、規格、批號、儲位搜尋
3. 表格欄位：公司、品名、規格、批號、數量、重量、位置、效期
4. 點擊「匯出庫存」可下載 Excel 檔案

#### 篩選邏輯
- 公司篩選：精確比對
- 搜尋：模糊比對（同時搜尋多個欄位）

---

## 戰情分析

### 儀表板

#### 功能說明
即時顯示倉庫關鍵指標，包括庫存統計、效期警示、近期動態等。

#### 顯示內容
1. **庫存總覽**
   - 總板數
   - 成品數量
   - 原料數量
   - 半成品數量

2. **效期警示**
   - 已過期品項
   - 30天內到期
   - 90天內到期

3. **庫存分布圓餅圖**
   - 依產品類別分布

4. **近期異動**
   - 最近入庫/出庫記錄

---

## 入庫管理

### 智能入庫

#### 功能說明
單板/多板入庫作業，系統自動建議最佳儲位。

#### 操作步驟
1. 進入「入庫管理 > 智能入庫」
2. **選擇公司**：崇文 / 八方
3. **選擇類別**：
   - 採購進貨（Raw）
   - 產線成品（FG）
   - 產線半成品（WIP）
   - 餘料退庫（Return）
4. **填寫入庫資訊**：
   - 品名（必填）
   - 規格
   - 批號（必填）
   - 效期（必填）
   - 數量（必填）
   - 廠商
   - 工單號
5. **選擇產品類型**：
   - 定重：輸入每件重量
   - 不定重：輸入總重量，系統計算均重
6. **儲位分配**：
   - 自動分配：系統建議最佳儲位
   - 手動選擇：點選地圖選擇儲位
7. 點擊「確認入庫」

#### 智能儲位建議邏輯
1. 優先相同品項的巷道
2. 其次相鄰巷道
3. 避免跨區分散
4. 考慮效期管理（FEFO）

### 貨櫃入庫

#### 功能說明
大量入庫作業，適用於整櫃進貨。

#### 操作步驟
1. 進入「入庫管理 > 貨櫃入庫」
2. **選擇公司**：崇文 / 八方
3. **選擇類別**：採購進貨 / 產線成品 / 產線半成品 / 餘料退庫
4. **新增品項**：
   - 品名、規格、批號、效期
   - 數量（件數）
   - 總板數
5. 可新增多個品項
6. 系統自動計算每板分配
7. 點擊「執行入庫」

### 預排入庫

#### 功能說明
預先規劃入庫作業，產生標籤供現場使用。

#### 操作步驟
1. 進入「入庫管理 > 預排入庫」
2. **選擇公司**：崇文 / 八方
3. 填寫預排資訊：
   - 數量（張數）
   - 品名
   - 規格
   - 批號
   - 廠商
4. 點擊「產生標籤」
5. 預覽標籤內容
6. 點擊「列印」輸出

---

## 出庫管理

### 波次揀貨

#### 功能說明
依據訂單需求，智能計算最佳揀貨路徑。

#### 操作步驟
1. 進入「出庫管理 > 波次揀貨」
2. **選擇公司**：崇文 / 八方
3. **新建波次**：
   - 輸入品名搜尋（自動過濾該公司庫存）
   - 選擇產品
   - 輸入需求數量
   - 點擊「計算」
4. 系統顯示揀貨方案：
   - 依 FEFO（先效期先出）排序
   - 優先孤立儲位
   - 優先低樓層
5. 確認後加入波次
6. 可加入多個品項
7. 點擊「建立波次」
8. 可列印揀貨單

#### 揀貨優先順序
1. 效期最近優先（FEFO）
2. 孤立儲位優先（釋放空間）
3. 低樓層優先（省力）
4. 數量剛好優先（避免拆板）

### 原料領用

#### 功能說明
生產線領用原料，操作類似波次揀貨但有獨立計數。

#### 操作步驟
1. 進入「出庫管理 > 原料領用」
2. **選擇公司**：崇文 / 八方
3. 搜尋原料品名
4. 輸入領用數量
5. 計算揀貨方案
6. 確認領用
7. 系統自動扣減庫存

### 出貨派車

#### 功能說明
管理出貨排程和車輛調度。

#### 操作步驟
1. 進入「出庫管理 > 出貨派車」
2. 查看待出貨訂單
3. 安排車輛和時間
4. 產生派車單
5. 列印出貨文件

---

## 庫存異動作業

### 智能調度

#### 功能說明
自動分析庫存，建議合併和移位作業以優化倉庫空間。

#### 操作步驟
1. 進入「庫存異動作業 > 智能調度」
2. 點擊「重新分析」
3. 系統顯示建議工單：
   - 🟠 合併工單：相同品項可合併
   - 🔵 移位工單：需要搬移的項目
   - 🟢 釋放工單：可釋放的儲位
4. 勾選要執行的工單
5. 點擊「發布」推送到行動裝置
6. 或點擊「列印」輸出紙本工單

### 板號異動

#### 功能說明
手動執行儲位移動或庫存合併。

#### 移動儲位
1. 進入「庫存異動作業 > 板號異動」
2. 選擇「移動儲位」模式
3. 掃描或輸入入庫單號
4. 系統顯示該板資訊（含公司別）
5. 輸入目標儲位
6. 確認移動

#### 合併庫存
1. 選擇「合併庫存」模式
2. 掃描要保留的板（A）
3. 掃描要併入的板（B）
4. 確認合併（B 的數量會加到 A，B 會被刪除）

### 倉庫調撥

#### 功能說明
本倉與外倉之間的庫存調撥。

#### 調撥模式

**調撥入庫**（外倉 → 本倉）
1. 進入「庫存異動作業 > 倉庫調撥」
2. 選擇公司：崇文 / 八方
3. 選擇「調撥入庫」
4. 選擇來源外倉
5. 搜尋產品
6. 輸入調撥數量
7. 加入調撥清單
8. 執行調撥

**調撥出庫**（本倉 → 外倉）
1. 選擇「調撥出庫」
2. 選擇目標外倉
3. 搜尋本倉庫存
4. 選擇儲位和數量
5. 加入調撥清單
6. 執行調撥

**外庫調撥**（外倉 → 外倉）
1. 選擇「外庫調撥」
2. 選擇來源外倉
3. 選擇目標外倉
4. 搜尋產品
5. 輸入數量
6. 執行調撥

### 庫存盤點

#### 功能說明
建立盤點任務，進行實際庫存盤點。

#### 操作步驟
1. 進入「庫存異動作業 > 庫存盤點」
2. 點擊「建立盤點單」
3. 選擇盤點範圍（區域/巷道）
4. 系統產生盤點清單
5. 逐一輸入實際數量
6. 標記差異項目
7. 完成盤點後提交

---

## 倉租寄倉

### 寄倉管理

#### 功能說明
管理客戶寄存在倉庫的貨物。

#### 新增寄倉
1. 進入「倉租寄倉 > 寄倉管理」
2. 點擊「新增寄倉」
3. 選擇來源：
   - 本倉庫存
   - 外倉庫存
4. 勾選要寄存的品項
5. 填寫客戶名稱
6. 選擇寄庫倉
7. 設定寄倉日期和免費期限
8. 確認新增

#### 提貨作業
1. 在寄倉列表找到該筆記錄
2. 點擊「提貨」按鈕
3. 輸入提貨日期和數量
4. 確認提貨
5. 系統自動更新剩餘數量

#### 篩選功能
- 狀態：全部 / 免費期 / 計費中 / 已結清
- 來源：全部 / 本倉 / 外倉
- 搜尋：客戶、品名、批號

### 倉租報表

#### 功能說明
計算指定月份的倉租費用。

#### 操作步驟
1. 進入「倉租寄倉 > 倉租報表」
2. 選擇計費月份
3. 點擊「計算」
4. 顯示兩個報表：
   - 自有庫存倉租（如有開啟收費）
   - 寄倉客戶倉租

#### 計費規則
- 依每板件數換算板數
- 崇文：階梯費率（前300板 $22/天，超過 $20/天）
- 八方：固定費率 $22/天

### 費率設定

#### 功能說明
設定倉租計費相關參數。

#### 設定項目
1. **自有庫存收費開關**
   - 崇文：是/否
   - 八方：是/否
   - 生效日期

2. **倉租費率**
   - 八方一般費率
   - 崇文第一階段上限
   - 崇文第一階段費率
   - 崇文第二階段費率

3. **理貨費用**
   - 入庫費用
   - 出庫費用

4. **暫存區設定**
   - 免費時數

5. **結算設定**
   - 結算日
   - 免費到期日

---

## 進階報表

### 異動查詢

#### 功能說明
查詢所有庫存異動記錄。

#### 操作步驟
1. 進入「進階報表 > 異動查詢」
2. 設定查詢條件：
   - 日期範圍（今日/本週/本月/自訂）
   - 異動類型（入庫/出庫/移位/合併/調整）
   - 品名搜尋
3. 點擊「查詢」
4. 結果顯示：日期時間、公司、類型、品項、數量、儲位、批號、備註

#### 快速篩選
- 今日
- 本週
- 本月
- 近30天

### 品項分析

#### 功能說明
分析各品項的庫存分布和週轉情況。

#### 顯示內容
- 品項庫存量排行
- 品項分布位置
- 入出庫頻率

### 效期管理

#### 功能說明
專門管理效期相關事務。

#### 功能區塊
1. **效期警示看板**
   - 已過期（紅色）
   - 30天內到期（橙色）
   - 90天內到期（黃色）

2. **效期報表**
   - 依效期排序清單
   - 可匯出 Excel

3. **警示設定**
   - 設定「即將到期」天數閾值

### 熱區分析

#### 功能說明
分析倉庫各區域的使用頻率。

#### 顯示內容
- 各區域出入庫次數
- 熱門儲位排行
- 空間使用率

---

## 系統管理

### 品項主檔

#### 功能說明
維護產品基本資料，供系統自動計算使用。

#### 操作步驟
1. 進入「系統管理 > 品項主檔」
2. **新增品項**：
   - 品名（必填）
   - 規格
   - 板容量（每板件數，必填）
   - 零頭閾值（%）
   - 保存期限（月）
   - 類別
   - 備註
3. 點擊「儲存」

#### 自動匯入
- 點擊「從庫存匯入」
- 系統自動掃描庫存中的品項
- 新品項會加入主檔（預設板容量 45）
- 需手動調整正確的板容量

### 外倉管理

#### 功能說明
管理外部倉庫的庫存。

#### 操作步驟
1. 進入「系統管理 > 外倉管理」
2. **篩選**：
   - 公司：全部 / 崇文 / 八方
   - 倉庫：選擇特定外倉
3. **手動調整**：
   - 選擇公司
   - 選擇外倉
   - 輸入品名、規格、批號、效期
   - 輸入數量（正數=增加，負數=扣減）
   - 選擇原因
   - 點擊「調整」

### 倉庫設定

#### 功能說明
管理外倉清單。

#### 預設外倉（崇文）
| 代碼 | 名稱 |
|------|------|
| CW-STORE | 門市倉 |
| CW-JS1 | 景山1號 |
| CW-JS2 | 景山2號 |
| CW-QT | 洽通 |
| CW-YX | 有興 |
| CW-FK | 富崑 |
| CW-PS | 品順 |

#### 預設外倉（八方）
| 代碼 | 名稱 |
|------|------|
| BF-STORE | 門市倉 |
| BF-JS1 | 景山1號 |
| BF-JS2 | 景山2號 |
| BF-QT | 洽通 |
| BF-YX | 有興 |
| BF-FK | 富崑 |
| BF-PS | 品順 |

#### 新增外倉
1. 填寫倉庫代碼
2. 填寫倉庫名稱
3. 選擇所屬公司
4. 點擊「新增」

### 使用者管理

#### 功能說明
管理系統使用者帳號和權限。

#### 操作步驟
1. 進入「系統管理 > 使用者管理」
2. **新增使用者**：
   - Email
   - 密碼
   - 顯示名稱
   - 選擇角色
   - 勾選權限
3. **編輯使用者**：
   - 點擊編輯按鈕
   - 修改資料
   - 儲存
4. **停用使用者**：
   - 點擊停用按鈕

### 資料備份

#### 功能說明
備份和還原系統資料。

#### 備份操作
1. 進入「系統管理 > 資料備份」
2. 點擊「立即備份」
3. 選擇備份方式：
   - 下載 JSON 檔案
   - 儲存到 Firebase

#### 還原操作
1. 點擊「還原資料」
2. 選擇備份來源：
   - 上傳 JSON 檔案
   - 從 Firebase 選擇
3. 選擇要還原的資料表
4. 確認還原

#### 備份內容（13項）
1. 庫存資料 (pallets)
2. 銷貨訂單 (salesOrders)
3. 波次資料 (waves)
4. 異動記錄 (inventoryLogs)
5. 入庫單 (inboundOrders)
6. 入庫任務 (inboundTasks)
7. 出貨單 (shippingOrders)
8. 派車單 (dispatchOrders)
9. 外部庫存 (externalStock)
10. 品項主檔 (productMaster)
11. 外倉設定 (warehouses)
12. 寄倉資料 (consignments)
13. 系統設定 (settings)

---

## 資料同步與備份

### Firebase 雲端同步

#### 同步機制
- 所有資料即時同步到 Firebase Firestore
- 多裝置同時操作，資料自動更新
- 離線時使用 localStorage 暫存，上線後同步

#### 同步資料表

| Collection | 說明 | 同步方式 |
|------------|------|----------|
| pallets | 庫存資料 | 即時監聽 |
| salesOrders | 銷貨訂單 | 即時監聽 |
| waves | 波次資料 | 讀寫同步 |
| inventoryLogs | 異動記錄 | 寫入同步 |
| externalStock | 外部庫存 | 讀寫同步 |
| productMaster | 品項主檔 | 讀寫同步 |
| warehouses | 外倉設定 | 讀寫同步 |
| consignments | 寄倉資料 | 讀寫同步 |
| settings | 系統設定 | 讀寫同步 |

### 備份提醒
- 系統會記錄上次備份時間
- 超過設定天數（預設7天）會提醒備份
- 可在設定中調整提醒頻率

---

## 公司別管理

### 雙公司架構

本系統支援兩家關係企業共用倉庫：
- **崇文**：藍色標籤
- **八方**：紫色標籤

### 公司別欄位位置

| 功能 | 公司選擇位置 |
|------|-------------|
| 智能入庫 | 頂部選項 |
| 貨櫃入庫 | 頂部選項 |
| 預排入庫 | 頂部選項 |
| 波次揀貨 | 頂部按鈕 |
| 原料領用 | 頂部按鈕 |
| 倉庫調撥 | 頂部按鈕 |
| 外倉管理 | 頂部按鈕 |
| 庫存查詢 | 頂部按鈕 |

### 公司別過濾邏輯
- 入庫時：記錄所選公司
- 出庫時：只顯示該公司的庫存
- 調撥時：只能調撥同公司的庫存
- 查詢時：可選擇全部或特定公司

### 外倉與公司對應
- 每個外倉屬於特定公司
- 調撥時只能選擇同公司的外倉
- 外倉管理可依公司篩選

---

## 快捷鍵與技巧

### 通用操作
- **Enter**：確認輸入（大部分輸入框）
- **Esc**：關閉彈出視窗
- **Tab**：切換下一個輸入欄位

### 掃描器支援
- 支援條碼掃描器輸入
- 掃描入庫單號可快速查詢
- 掃描儲位條碼可快速定位

### 列印功能
- 入庫標籤
- 波次揀貨單
- 調度工單
- 倉租報表

---

## 常見問題

### Q: 忘記密碼怎麼辦？
A: 請聯繫系統管理員重設密碼。

### Q: 資料沒有同步怎麼辦？
A: 
1. 檢查網路連線
2. 重新整理頁面
3. 檢查 Firebase 狀態

### Q: 如何匯出資料？
A: 
1. 各查詢頁面都有「匯出」按鈕
2. 匯出格式為 Excel (.xlsx)

### Q: 如何批量修改資料？
A: 
1. 使用「期初匯入」功能
2. 準備 Excel 檔案
3. 依範本格式填寫
4. 上傳匯入

---

## 版本記錄

### V50.9 (2024-12-22)
- 新增：波次資料 Firebase 同步
- 新增：寄倉資料 Firebase 同步
- 新增：倉租設定 Firebase 同步
- 修正：公司別全面整合
- 修正：異動記錄加入公司欄位
- 優化：備份範圍擴充至 13 個 Collection

### V50.8
- 新增：品項主檔 Firebase 同步

### V50.7
- 修正：調撥出庫功能修復
- 新增：異動記錄公司欄位
- 優化：匯出庫存加入公司欄位

### V50.6
- 優化：導航列整合
- 新增：數位倉庫群組（倉庫地圖 + 庫存查詢）

### V50.5
- 優化：功能列名稱調整
- 新增：庫存查詢公司過濾

### V50.4
- 優化：倉庫調撥頁面 UI

### V50.3
- 新增：多頁面公司欄位整合

---

## 技術支援

如有任何問題，請聯繫系統管理員。

---

*文件版本：V50.9*
*最後更新：2024-12-22*
